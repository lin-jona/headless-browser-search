# Headless Browser ç½‘é¡µæœç´¢å·¥å…·

è¿™æ˜¯ä¸€ä¸ªåŸºäº Puppeteer çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºæ‰§è¡Œç½‘é¡µæœç´¢å¹¶æå–æœç´¢ç»“æœå†…å®¹ã€‚è¯¥å·¥å…·ä½¿ç”¨æ— å¤´æµè§ˆå™¨æŠ€æœ¯ï¼Œé€šè¿‡ [OpenXNG æœç´¢å¼•æ“](https://opnxng.com/)è¿›è¡Œå†…å®¹æ£€ç´¢ï¼Œå¹¶å°†ç»“æœä»¥ç»“æ„åŒ–çš„ XML æ ¼å¼è¾“å‡ºï¼Œé€‚åˆéœ€è¦æ‰¹é‡è·å–ç½‘é¡µå†…å®¹çš„åœºæ™¯ã€‚

## ä¸»è¦ç‰¹æ€§

- ğŸš€ åŸºäº Puppeteer çš„é«˜æ€§èƒ½ç½‘é¡µå†…å®¹æŠ“å–
- ğŸ” æ™ºèƒ½æœç´¢ç»“æœè¿‡æ»¤ï¼Œæ”¯æŒè‡ªå®šä¹‰æ’é™¤åŸŸå
- ğŸ“ ä½¿ç”¨ Mozilla çš„ Readability ç®—æ³•æå–é¡µé¢ä¸»è¦å†…å®¹
- âœ¨ è‡ªåŠ¨å°† HTML è½¬æ¢ä¸ºå¹²å‡€çš„çº¯æ–‡æœ¬æ ¼å¼
- ğŸŒŠ åŸºäº Node.js æµå¼å¤„ç†ï¼Œæ”¯æŒå¤§é‡æ•°æ®å¤„ç†
- ğŸ“¸ å†…ç½®æˆªå›¾åŠŸèƒ½ï¼Œæ–¹ä¾¿è°ƒè¯•å’ŒéªŒè¯
- ğŸ›¡ï¸ å†…ç½®è¯·æ±‚æ‹¦æˆªï¼Œä¼˜åŒ–æ€§èƒ½å’Œèµ„æºä½¿ç”¨

## ç³»ç»Ÿè¦æ±‚

- Node.js 16.0.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- Windows/Linux/MacOS æ“ä½œç³»ç»Ÿ

## å¿«é€Ÿå¼€å§‹

### å®‰è£…

1. å…‹éš†ä»“åº“ï¼š
```bash
git clone https://github.com/lin-jona/headless-browser-search.git
```

2. è¿›å…¥é¡¹ç›®ç›®å½•ï¼š
```bash
cd headless-browser-search
```

3. å®‰è£…ä¾èµ–ï¼š
```bash
npm install
```

### åŸºæœ¬ä½¿ç”¨

1. ç›´æ¥æœç´¢ï¼š
```bash
echo "ä½ æƒ³æœç´¢çš„å†…å®¹" | node search.js
```

2. ä»æ–‡ä»¶è¯»å–æœç´¢å†…å®¹ï¼š
```bash
cat search_query.txt | node search.js > output.txt
```

### è¾“å‡ºæ ¼å¼

æœç´¢ç»“æœå°†ä»¥ XML æ ¼å¼è¾“å‡ºï¼ŒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š
```xml
<article>
    <title>é¡µé¢æ ‡é¢˜</title>
    <url>é¡µé¢URL</url>
    <content>æå–çš„ä¸»è¦å†…å®¹</content>
</article>
```

## é«˜çº§é…ç½®

### æµè§ˆå™¨é…ç½®
åœ¨ `src/browser.js` ä¸­å¯ä»¥è‡ªå®šä¹‰æµè§ˆå™¨è¡Œä¸ºï¼š

```javascript
export const browserLaunchOptions = {
    headless: "new",          // è®¾ç½®ä¸º false å¯å¼€å¯æµè§ˆå™¨ç•Œé¢
    defaultViewport: {        // è®¾ç½®è§†çª—å¤§å°
        width: 1080, 
        height: 1024
    },
    args: [                   // è‡ªå®šä¹‰å¯åŠ¨å‚æ•°
        "--no-sandbox",
        "--disable-setuid-sandbox",
        "--incognito"         // ä½¿ç”¨æ— ç—•æ¨¡å¼
    ]
};

export const maxResults = 5;  // æ§åˆ¶æœ€å¤§ç»“æœæ•°
```

### åŸŸåè¿‡æ»¤
åœ¨ `src/utils.js` ä¸­å¯ä»¥é…ç½®éœ€è¦æ’é™¤çš„åŸŸåï¼š

```javascript
let excludeDomains = [
    "blog.csdn.net",
    "baidu.com",
    "zhihu.com",
    // æ·»åŠ æ›´å¤šéœ€è¦æ’é™¤çš„åŸŸå
]
```

## é¡¹ç›®ç»“æ„

```plaintext
headless-browser-search/
â”œâ”€â”€ search.js          # ç¨‹åºå…¥å£ç‚¹
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ browser.js     # æµè§ˆå™¨é…ç½®å’Œå¯åŠ¨é€‰é¡¹
â”‚   â”œâ”€â”€ macro.js       # Readability è„šæœ¬åŠ è½½å™¨
â”‚   â”œâ”€â”€ pipeline.js    # æ•°æ®å¤„ç†æµæ°´çº¿
â”‚   â”œâ”€â”€ to-markdown.js # HTML è½¬æ¢å·¥å…·
â”‚   â””â”€â”€ utils.js       # å·¥å…·å‡½æ•°å’Œé…ç½®
â””â”€â”€ package.json       # é¡¹ç›®ä¾èµ–é…ç½®
```

## æ ¸å¿ƒä¾èµ–

- **puppeteer**: ^21.0.0 - Chrome è‡ªåŠ¨åŒ–å·¥å…·
- **@mozilla/readability**: ^0.4.4 - ç½‘é¡µå†…å®¹æå–åº“
- **turndown**: ^7.1.2 - HTML åˆ°æ–‡æœ¬è½¬æ¢å·¥å…·
- **turndown-plugin-gfm**: ^1.0.2 - GitHub é£æ ¼ Markdown æ”¯æŒ
- **esbuild**: ^0.19.2 - é«˜æ€§èƒ½ JavaScript æ‰“åŒ…å·¥å…·

## å·¥ä½œæµç¨‹

1. æ¥æ”¶æœç´¢æŸ¥è¯¢è¾“å…¥
2. å¯åŠ¨é…ç½®å¥½çš„ Puppeteer å®ä¾‹
3. è®¿é—® OpenXNG æœç´¢å¼•æ“ (https://opnxng.com/) å¹¶æ‰§è¡Œæœç´¢
4. æ™ºèƒ½è¿‡æ»¤æœç´¢ç»“æœé“¾æ¥
5. å¹¶è¡Œå¤„ç†å¤šä¸ªæœç´¢ç»“æœ
6. ä½¿ç”¨ Readability æå–æ ¸å¿ƒå†…å®¹
7. è½¬æ¢å¹¶æ¸…ç†å†…å®¹æ ¼å¼
8. é€šè¿‡æµå¤„ç†è¾“å‡ºç»“æœ

## æ•…éšœæ’é™¤

- å¦‚æœé‡åˆ° Puppeteer å¯åŠ¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç³»ç»Ÿä»£ç†è®¾ç½®
- å†…å­˜ä½¿ç”¨è¿‡é«˜æ—¶ï¼Œå¯ä»¥é€šè¿‡è°ƒæ•´ `maxResults` æ¥é™åˆ¶ç»“æœæ•°é‡
- å¦‚æœæå–ç»“æœä¸ç†æƒ³ï¼Œå¯ä»¥è°ƒæ•´ `SELECTORS_TO_REMOVE` é…ç½®

## è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº MIT License å¼€æºã€‚

## è‡´è°¢

æœ¬é¡¹ç›®åŸºäº [local-web-search](https://github.com/egoist/local-web-search) è¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼Œæ„Ÿè°¢åŸä½œè€…çš„è´¡çŒ®ã€‚

## è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Request æ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ã€‚